#:kivy 1.9.1

<MainScreen>:
    id: main_screen
    orientation: 'horizontal'
    dynamic_layout: dynamic_layout

    DynamicLayout:
        id: dynamic_layout
        indicator_layout: indicator_layout
        button_layout: button_layout
        indicator_edit_popup: indicator_edit_popup
        button_edit_popup: button_edit_popup
        modify_mode: False
        on_parent: if self.parent == main_screen: self.parent.remove_widget(self)

    ToggleButton:
        id: modify_screen
        text: 'Modify Screen'
        size_hint: 0.1, 1
        on_press:
            if self.state == 'down': dynamic_layout.modify_screen()
            else: dynamic_layout.end_modify()

    GridLayout:
        id: indicator_layout
        size_hint: 0.25, 1
        cols: 1

    GridLayout:
        id: button_layout
        size_hint: 0.65, 1
        rows: 2

    IndicatorEditPopup:
        id: indicator_edit_popup
        ind_label_input: ind_label_input
        ind_channel_spinner: ind_channel_spinner
        dynamic_layout: dynamic_layout
        modify_mode: dynamic_layout.modify_mode
        title: "Change Indicator Label"
        size_hint: None, None
        size: 300, 250
        pos_hint: {'middle': 1, 'top': 1}
        on_parent: if self.parent == main_screen: self.parent.remove_widget(self)

        BoxLayout:
            orientation: 'vertical'
            spacing: 5
            padding: 5

            LabelInput:
                id: ind_label_input
                size_hint: 1, .35

            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1, .25

                Label:
                    text: 'Channel:'
                    size_hint: .3, 1

                Spinner:
                    id: ind_channel_spinner
                    size_hint: .7, 1
                    text: '0'
                    values: ('0', '1', '2', '3', '4', '5')

            GridLayout:
                rows: 1
                cols: 2
                size_hint: 1, .4
                spacing: 5

                Button:
                    text: 'OK'
                    on_press: indicator_edit_popup.save_indicator()

                Button:
                    text: 'Cancel'
                    on_press: indicator_edit_popup.dismiss()

    ButtonEditPopup:
        id: button_edit_popup
        label_input: label_input
        toggle_check: toggle_check
        channel_spinner: channel_spinner
        dynamic_layout: dynamic_layout
        modify_mode: dynamic_layout.modify_mode
        title: "Change Button Label"
        size_hint: None, None
        size: 300, 250
        pos_hint: {'middle': 1, 'top': 1}
        on_parent: if self.parent == main_screen: self.parent.remove_widget(self)

        BoxLayout:
            orientation: 'vertical'
            spacing: 5
            padding: 5

            LabelInput:
                id: label_input
                size_hint: 1, 0.3

            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1, .2

                Label:
                    text: 'Toggle?:'
                    size_hint: .3, 1

                CheckBox:
                    id: toggle_check
                    size_hint: .7, 1

            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1, .2

                Label:
                    text: 'Channel:'
                    size_hint: .3, 1

                Spinner:
                    id: channel_spinner
                    size_hint: .7, 1
                    text: '0'
                    values: ('0', '1', '2', '3', '4', '5')

            GridLayout:
                rows: 1
                cols: 2
                size_hint: 1, 0.3
                spacing: 5

                Button:
                    text: 'OK'
                    on_press: button_edit_popup.save_button()

                Button:
                    text: 'Cancel'
                    on_press: button_edit_popup.dismiss()


<IndicatorButton, DynToggleButton, DynButton, LabelInput@TextInput>:
    text_size: self.size
    font_size: '18sp'
    halign: 'center'
    valign: 'middle'